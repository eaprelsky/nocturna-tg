# Nginx configuration for Nocturna Telegram Bot
# Path: /etc/nginx/sites-available/nocturna-tg
#
# This configuration is for webhook mode only.
# If running in polling mode, Nginx is not required.

server {
    listen 80;
    listen [::]:80;
    server_name tg.nocturna.ru;

    # Логи
    access_log /var/log/nginx/tg.nocturna.ru_access.log;
    error_log /var/log/nginx/tg.nocturna.ru_error.log;

    # Локация для Certbot (Let's Encrypt)
    location /.well-known/acme-challenge/ {
        root /var/www/html;
    }

    # Redirect all HTTP to HTTPS (certbot will add this automatically)
    # Uncomment after SSL certificate is installed
    # return 301 https://$server_name$request_uri;
}

# HTTPS configuration (uncomment after certbot setup)
# server {
#     listen 443 ssl http2;
#     listen [::]:443 ssl http2;
#     server_name tg.nocturna.ru;
# 
#     # SSL certificates (certbot will manage these)
#     # ssl_certificate /etc/letsencrypt/live/tg.nocturna.ru/fullchain.pem;
#     # ssl_certificate_key /etc/letsencrypt/live/tg.nocturna.ru/privkey.pem;
#     # include /etc/letsencrypt/options-ssl-nginx.conf;
#     # ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
# 
#     # Логи
#     access_log /var/log/nginx/tg.nocturna.ru_access.log;
#     error_log /var/log/nginx/tg.nocturna.ru_error.log;
# 
#     # Security headers
#     add_header X-Content-Type-Options nosniff;
#     add_header X-Frame-Options DENY;
#     add_header X-XSS-Protection "1; mode=block";
# 
#     # Telegram webhook endpoint
#     location /webhook {
#         proxy_pass http://localhost:8080;
#         proxy_http_version 1.1;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#         
#         # Telegram webhook требования (увеличены для долгих операций)
#         proxy_connect_timeout 60s;
#         proxy_send_timeout 60s;
#         proxy_read_timeout 60s;
#         
#         # Allow only Telegram IP ranges (optional, for extra security)
#         # See https://core.telegram.org/bots/webhooks#the-short-version
#         # allow 149.154.160.0/20;
#         # allow 91.108.4.0/22;
#         # deny all;
#     }
# 
#     # Health check endpoint
#     location /health {
#         proxy_pass http://localhost:8080;
#         access_log off;
#     }
# 
#     # Остальные запросы - 404
#     location / {
#         return 404;
#     }
# }

