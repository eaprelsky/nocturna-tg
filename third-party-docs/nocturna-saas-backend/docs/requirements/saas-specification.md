# Nocturna - сервис для астрологических расчетов

## Ключевые функции

- Просмотр текущих транзитов
- Построение своей натальной карты
- Построение двойной карты (синастрии, хорары и прочие вопросы взаимодействия)
- Диалог с LLM-астрологом, имеющим доступ к реальным астрологическим расчетам и к данным отображаемой карты  (астрологические консультации по любым вопросам)
- Сохранение и загрузка пользовательски чартов в базу / из базы (для Pro)

## Ключевые нефункциональные требования
- Многоязычность: поддержка двух языков (русский, английский), язык определяется автоматически.

## Роли в системе
- В системе должны быть роли:
  - Администратор
  - Гость (незарегистрированный пользователь)
  - Обычный пользователь (зарегистрированный)
  - Пользователь Plus
  - Пользователь Pro
  - Пользователь Promo

### Администратор
Задачи:
- Управление пользователями
  - Ручное создание-редактирование-удаление
  - Ручное начисление кредитов
  - Ручное продвижение до Promo и снятие статуса Promo
  - Начисление кредитов для платных вопросов
- Управление биллингом
- Управление настройками системы
  - Credentials для телеграм-канала настройки
  - Переключение LLM
  - Лимиты по по ролям 
    - Количество кредитов, доступных пользователю каждой роли еженедельно (1 кредит = 1 вопрос к LLM по астрологической карте)
    - Стимость кредита для каждой роли пользователя в рублях и в долларах отдельно, без привязки к курсу
    - Стоимость ежемесячной подписки для каждой платной роли (Plus, Pro)
  - Аналитика:
    - Журнал пользовательских действий
    - Просмотр, редактирование, удаление фича-реквестов
 
  # Гость (незарегистрированный пользователь)
  - Гороскопы:
    - Просмотр транзитов (день, месяц, год)
    - Построение натальной карты
    - Интерпретация своей натальной карты
  - Доступ к контенту:
    - Просмотр статичного контента (FAQ, справочная информация по астрологии)
    - Справочник интерпретаций (просмотр и поиск)
  - Служебные функции:
    - Переключение языков
    - Авторизация и регистрация

  # Обычный пользователь (зарегистрированный)
  - То же, что и гость
  - Сохранение своей натальной карты
  - Построение карт с разными данными, в том числе двойных (без возможности сохранения)
  - Диалог с LLM по своей натальной карте или по карте с другими данными, в том числе, по двойной. Количество вопросов лимитировано и определяется настройками системы и количеством оставшихся кредитов у пользователя.
  - Запросы в техподдержку
    - Отправка сообщения в телеграм с заданными credentials 


  # Пользователь Plus
  - То же, что и обычный пользователь
    - Работа с запросами по доработке системы:
    - Просмотр фича-реквестов
    - Добавление новых фича-реквестов
    - Голосование за фича-реквесты 
  
  # Пользователь Pro
  - Сохранение различных чартов (как одинарных, так и двойных) под разными названиями
  - Справочник интерпретаций, с поиском
  
  # Пользователь Promo
- Бесплатное использование всех функций
  

## Требования к пользовательскому интерфейсу

- Минималистичный дизайн
- Небольшое количество цветов
- Минимальное количество визуальных элементов (только самое нужное)
- Интерфейсы, эффективные по GOMS

## Технические требования

### Функции SaaS бэкенда
- Проброс всех функций nocturna-calculations (websockets)
- Управление пользователями
- Управление чартами
- Управление подписками

### Стратегия управления данными

- Интеграция данных происходит на стороне SaaS-бэкенда (Python, FastAPI)s
- Схема данных для бизнес-логики Postgresql
- Кэширование запросов в Redis
- Кэширование интерпретаций, полученных от LLM, в Clickhouse, создание базы интерпретаций (feature, interpretation)
- Всё взаимодействие по умолчанию происходит по websockets, но если вебсокеты не работают, то резервный вариант - REST API.
- Весь статичный контент хранится в коде фронтенда в markdown, и "на лету" сериализуется в DOM


### Системные компоненты
- Node.js
- Clickhouse
- Postgresql
- Redis
- SMTP сервер